#!/bin/sh

set -e

echo "Removing unwanted files"

# Get POTFILES_DOT_IN
. /usr/share/tails/build/variables

find /usr/share/doc -type f -name changelog.gz        -delete
find /usr/share/doc -type f -name changelog.Debian.gz -delete
find /usr/share/doc -type f -name NEWS.Debian.gz      -delete

# Remove .in files managed by intltool
# shellcheck disable=SC2086
rm $POTFILES_DOT_IN

# These files are not needed after the Tor Browser has been installed
# (by the 10-tbb hook)
rm /usr/share/tails/tbb-*.txt

# Remove the snakeoil SSL key pair generated by ssl-cert
find /etc/ssl/certs /etc/ssl/private |
    while read -r f; do
       if [ "$(readlink -f "$f")" = "/etc/ssl/certs/ssl-cert-snakeoil.pem" ] || \
          [ "$(readlink -f "$f")" = "/etc/ssl/private/ssl-cert-snakeoil.key" ]; then
	   rm "${f}"
       fi
    done
update-ca-certificates

# Remove the kernel .map files which are only useful for kernel
# debugging (and slightly make things easier for malware, perhaps) and
# otherwise just occupy disk space.
rm -f /boot/*.map /boot/*.map-*

# Files needed at build time for preparing the Unsafe Browser
rm /usr/local/bin/jsonlz4
rm /usr/share/tails/chroot-browsers/unsafe-browser/addonStartup.json

# Firmware that's useless in the context of Tails
rm -r /lib/firmware/mrvl/prestera/

# Website bits that are not useful inside Tails
rm usr/share/doc/tails/website/torrents/rss.html

# Documentation that's large and not that useful in Tails
rm -r /usr/share/inkscape/examples
